<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Create a (list of) kanjivec object(s). Each object is a representation of the kanji as a tree of strokes
based on .svg files from the KanjiVG database containing further, derived information."><title>Create kanjivec objects from kanjivg data — kanjivec • kanjistat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create kanjivec objects from kanjivg data — kanjivec"><meta property="og:description" content="Create a (list of) kanjivec object(s). Each object is a representation of the kanji as a tree of strokes
based on .svg files from the KanjiVG database containing further, derived information."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">kanjistat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.11.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/kanjistat.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dschuhmacher/kanjistat/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create kanjivec objects from kanjivg data</h1>
      <small class="dont-index">Source: <a href="https://github.com/dschuhmacher/kanjistat/blob/HEAD/R/kanjivec.R" class="external-link"><code>R/kanjivec.R</code></a></small>
      <div class="d-none name"><code>kanjivec.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a (list of) kanjivec object(s). Each object is a representation of the kanji as a tree of strokes
based on .svg files from the KanjiVG database containing further, derived information.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">kanjivec</span><span class="op">(</span></span>
<span>  <span class="va">kanji</span>,</span>
<span>  database <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  flatten <span class="op">=</span> <span class="st">"intelligent"</span>,</span>
<span>  save <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  simplify <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>kanji</dt>
<dd><p>a (vector of) character string(s) of one or several kanji.</p></dd>


<dt>database</dt>
<dd><p>the path to a local copy of (a subset of) the KanjiVG database. It is expected
that the svg files reside at this exact location (not in a subdirectory). If <code>NULL</code>,
an attempt is made to read the svg file(s) from the KanjiVG GitHub repository (after
prompting for confirmation, which can be switched off via the <a href="options.html">option</a>
<code>ask_github</code>).</p></dd>


<dt>flatten</dt>
<dd><p>logical. Should nodes that are only-children be fused with their parents?
Alternatively one of the strings "intelligent", "inner" or "leaves". Although the first is the default
it is experimental and the precise meaning will change in the future; see details.</p></dd>


<dt>save</dt>
<dd><p>logical or character. If FALSE return the (list of) kanjivec object(s). Otherwise save the result
as an rds file in the working directory (as kvecsave.rds) or under the file path provided.</p></dd>


<dt>overwrite</dt>
<dd><p>logical. If FALSE return an error (before any computations are done) if the designated
file path already exists. Otherwise an existing file is overwritten.</p></dd>


<dt>simplify</dt>
<dd><p>logical. Shall a single kanjivec object be returned (instead a list of one) if <code>kanji</code>
is a single kanji?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list of objects of class <code>kanjivec</code> or, if only one kanji was specified and
<code>simplify</code> is <code>TRUE</code>, a single objects of class <code>kanjivec</code>. If <code>save = TRUE</code>,
the same is (saved and) still returned invisibly.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>A kanjivec object contains detailed information on the strokes of which an individual kanji
is composed including their order, a segmentation into reasonable components ("radicals" in a
more general sense of the word), classification of individual strokes, and both
vector data and interpolated points to recreate the actual stroke in a Kyoukashou style font.
For more information on the original data see <a href="http://kanjivg.tagaini.net/" class="external-link">http://kanjivg.tagaini.net/</a>. That data
is licenced under Creative Commons BY-SA 3.0 (see licence file of this package).</p>
<p>The original .svg files sometimes contain additional <code>&lt;g&gt;</code> elements that provide
information about the current group of strokes rather than establishing a new subgroup
of its own. This happens typically for information that establishes coherence with another
part of the tree (by noting that the current subgroup is also part 2 of something else),
but also for variant information. With the option <code>flatten = TRUE</code> the extra hierarchy
level in the tree is avoided, while the original information in the KanjiVG file is kept.
This is achieved by fusing only-children to their parents, giving the new node the name
of the child and all its attributes, but prefixing <code>p.</code> to the attribute names
of the parent (the parents' "names" attribute is discarded, but can be reconstructed from
the parents' id). Removal of several hierarchies in sequence can lead to attribute names
with multiple <code>p.</code> in front. Fusing to parents is suppressed if the parent is the
root of the hierarchy (typically for one-stroke kanji), as this could lead to confusing
results.</p>
<p>The options <code>flatten = "inner"</code> and <code>flatten = "leaves"</code> implement the above behavior
only for the corresponding type of node (inner nodes or leaves). The option
<code>flatten = "intelligent"</code> tries to find out in more sophisticated ways which flattening
is desirable and which is not (it will flatten rather conservatively). Currently nodes without
an element attribute that have only one child are flattened away (one example where this is
reasonable is in kanji <code>kbase[187, ]</code>), as are nodes with an element attribute and only
one child if this child is also an inner node and has the same element and part attribute as the
parent, but both have no number (this would be problematic for any component-building code
in the particular case of kanji <code>kbase[1111, ]</code>).</p>
<p>A <code>kanjivec</code> object has components</p><dl><dt><code>char</code></dt>
<dd><p>the kanji (a single character)</p></dd>

<dt><code>hex</code></dt>
<dd><p>its Unicode codepoint (integer of class <code>hexmode</code>)</p></dd>

<dt><code>padhex</code></dt>
<dd><p>the Unicode codepoint padded with zeros to five digits (mode character)</p></dd>

<dt><code>family</code></dt>
<dd><p>the font on which the data is based. Currently only "schoolbook" (to be extended with "kaisho" at some point)</p></dd>

<dt><code>nstrokes</code></dt>
<dd><p>the number of strokes in the kanji</p></dd>

<dt><code>ncompos</code></dt>
<dd><p>a vector of the number of components at each depth of the tree</p></dd>

<dt><code>nveins</code></dt>
<dd><p>the number of veins in the component structure</p></dd>

<dt><code>strokedend</code></dt>
<dd><p>the decomposition tree of the kanji as an object of class <code>dendrogram</code></p></dd>

<dt><code>components</code></dt>
<dd><p>the component structure by segmentation depth (components can overlap) in terms
of KanjiVG elements and their depth-first tree coordinates</p></dd>

<dt><code>veins</code></dt>
<dd><p>the veins in the component structure. Each vein is represented as a two-column matrix
that lists in its rows the indices of <code>components</code> (starting at the root,
which in the component indexing is <code>c(1,1)</code>)</p></dd>

<dt><code>stroketree</code></dt>
<dd><p>the decomposition tree of the kanji, a list containing the full information of the
the KanjiVG file (except some top level attributes)</p></dd>


</dl><p><code>stroketree</code> is a close representation of the KanjiVG svg file as list object with
some serious nesting of sublists. The XML attributes become attributes of the list and its elements.
The user will usually not have to look at or manipulate <code>stroketree</code> directly, but
<code>strokedend</code> and <code>compents</code> are derived from it and other functions may process it
further.</p>
<p>The main differences to the svg file are</p><ol><li><p>the actual strokes are not only given as d-attributes describing Bézier curves
but also as two-column matrices describing discretizations of these curves. These matrices
are the actual contents of the innermost lists in <code>stroketree</code>, but are more conveniently
accessed via the function <code><a href="get_strokes.html">get_strokes</a></code>.</p></li>
<li><p>The positions of the stroke numbers (for plotting) are saved as an attribute strokenum_coords
to the entire stroke tree rather than a separate element.</p></li>
</ol><p><code>strokedend</code> is more easy to examine and work with due to various convenience functions for
dendrograms in the packages <code>stats</code> and <code>dendextend</code>, including <code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></code>
and <code><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">plot.dendrogram</a></code>. The function <code><a href="plot.kanjivec.html">plot.kanjivec</a></code> with option
<code>type = "dend"</code> is a wrapper for <code><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">plot.dendrogram</a></code> with reasonable presets
for various options.</p>
<p>The label-attributes of the nodes of <code>strokedend</code> are taken from the element (for inner nodes)
and type (for leaves) attributes of the .svg files. They consist of UTF-8 characters representing
kanji parts and a combination of UTF-8 characters for representing strokes and may not represent
well in all CJK fonts (see details of <code><a href="plot.kanjivec.html">plot.kanjivec</a></code>). If element and type are missing
in the .svg file, the label assigned is the second part of the id-attribute, e.g. g5 or s9.</p>
<p>The <code>components</code> at a given level can be plotted, see <code><a href="plot.kanjivec.html">plot.kanjivec</a></code> with
<code>type = "kanji"</code>. Both <code>components</code> and <code>veins</code> serve mainly for the computation
of <a href="kanjidist.html">kanji distances</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plot.kanjivec.html">plot.kanjivec</a></code>, <code><a href="str.kanjivec.html">str.kanjivec</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Try to load the svg file for the kanji from GitHub.</span></span></span>
<span class="r-in"><span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">kanjivec</span><span class="op">(</span><span class="st">"藤"</span>, database<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fivebetas</span>  <span class="co"># sample kanjivec data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $kvec090e8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kanjivec representation of 部 (Unicode 90e8)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 stroke vector graphics with depth 3 decomposition</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $kvec0969c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kanjivec representation of 障 (Unicode 969c)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 stroke vector graphics with depth 3 decomposition</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $kvec0966a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kanjivec representation of 陪 (Unicode 966a)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 stroke vector graphics with depth 3 decomposition</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $kvec090f5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kanjivec representation of 郵 (Unicode 90f5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 stroke vector graphics with depth 4 decomposition</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $kvec09663</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kanjivec representation of 陣 (Unicode 9663)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 stroke vector graphics with depth 1 decomposition</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">fivebetas</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'kanjivec':	11 components:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ char      : chr "部"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ hex       : 'hexmode' int 90e8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ padhex    : chr "090e8"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ family    : chr "schoolbook"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ nstrokes  : int 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ ncompos   : num [1:4] 1 2 3 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ nveins    : int 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ strokedend:  ..--[dendrogram w/ 2 branches and 11 members at h = 4, label = 部]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |--[dendrogram w/ 2 branches and 8 members at h = 3, label = 咅]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |  |--[dendrogram w/ 2 branches and 5 members at h = 2, label = 立]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |  |  |--[dendrogram w/ 2 branches and 2 members at h = 1, label = 亠]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |  |  |  |--leaf "㇑a" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |  |  |  `--leaf "㇐" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |  |  `--[dendrogram w/ 3 branches and 3 members at h = 1, label = g4]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |  |     |--leaf "㇔" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |  |     |--leaf "㇒" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |  |     `--leaf "㇐" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |  `--[dendrogram w/ 3 branches and 3 members at h = 2, label = 口]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |     |--leaf "㇑" (h= 1  )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |     |--leaf "㇕b" (h= 1  )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  |     `--leaf "㇐b" (h= 1  )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..  `--[dendrogram w/ 3 branches and 3 members at h = 3, label = ⻏]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..     |--leaf "㇇" (h= 2  )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..     |--leaf "㇁" (h= 2  )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..     `--leaf "㇑" (h= 2  )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ components: (list of components organized by level)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ veins: (list of component coordinates from root to last inner node)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ stroketree: (nested list with original kanjivg info)</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Dominic Schuhmacher, Lennart Finke.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

